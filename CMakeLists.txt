cmake_minimum_required (VERSION 3.14)
project(KrattTestAssignment LANGUAGES C CXX)
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# LiteNetLibPP fork https://github.com/RedFox20/LiteNetLibPP
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/libs/LiteNetLibPP)

# GLFW+OpenGL https://github.com/glfw/glfw.git
find_package(OpenGL REQUIRED)
set(GLFW_BUILD_DOCS OFF CACHE BOOL "" FORCE)
set(GLFW_BUILD_TESTS OFF CACHE BOOL "" FORCE)
set(GLFW_BUILD_EXAMPLES OFF CACHE BOOL "" FORCE)
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/libs/glfw)

# Dear ImGui https://github.com/ocornut/imgui
set(IMGUI_DIR ${CMAKE_CURRENT_SOURCE_DIR}/libs/imgui)
file(GLOB IMGUI_SOURCES ${IMGUI_DIR}/*.cpp)
add_library(imgui STATIC ${IMGUI_SOURCES} ${IMGUI_DIR}/backends/imgui_impl_glfw.cpp
                                          ${IMGUI_DIR}/backends/imgui_impl_opengl3.cpp)
target_include_directories(imgui PUBLIC ${IMGUI_DIR} ${IMGUI_DIR}/backends)
target_link_libraries(imgui PUBLIC OpenGL::GL glfw dl)

# Mavlink2 autogenerated headers https://github.com/mavlink/c_library_v2.git
# no source files
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/libs/mavlink)

# Google Test https://github.com/google/googletest.git
# LiteNetLibPP already includes gtest, enable if using another sockets library
#add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/libs/googletest)

# GCS
add_executable(GCS src/gcs_main.cpp)
target_link_libraries(GCS PRIVATE lnl imgui)

# Drone
add_executable(Drone src/drone_main.cpp)
target_link_libraries(Drone PRIVATE lnl)

# Unit Tests
add_executable(UnitTests test/test_main.cpp)
target_link_libraries(UnitTests PRIVATE gtest lnl)